# Rust Cheet Sheet

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ø—Ä–æ–µ–∫—Ç



## –û—Å–Ω–æ–≤—ã —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞

```rust
fn main() {
    println!("Hello, world!");
}
```

- `//` ‚Äî –æ–¥–Ω–æ—Å—Ç—Ä–æ—á–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
- `/* */` ‚Äî –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ —Ç–∏–ø—ã

```rust
let x = 5;           // –Ω–µ–∏–∑–º–µ–Ω—è–µ–º–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
let mut y = 10;      // –∏–∑–º–µ–Ω—è–µ–º–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
const PI: f64 = 3.14; // –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞

let a: i32 = 42;
let b: f64 = 3.14;
let c: bool = true;
let d: char = 'ü¶Ä';
let s: &str = "—Å—Ç—Ä–æ–∫–∞";
```

## –£–ø—Ä–∞–≤–ª—è—é—â–∏–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

```rust
if x > 0 {
    println!("–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ");
} else {
    println!("–ù–æ–ª—å –∏–ª–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ");
}

for i in 0..5 {
    println!("{}", i);
}

while x < 10 {
    x += 1;
}

loop {
    break;
}
```

## Match

```rust
let dir = Direction::North;

match dir {
    Direction::North => println!("–°–µ–≤–µ—Ä"),
    Direction::South => println!("–Æ–≥"),
    _ => println!("–î—Ä—É–≥–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ"),
}
```

## –í–µ–∫—Ç–æ—Ä–∞, —Å—Ç—Ä–æ–∫–∏, –∫–æ—Ä—Ç–µ–∂–∏

```rust
let mut v = vec![1, 2, 3];
v.push(4);

let s = String::from("hello");
let slice = &s[0..2];

let tup = (1, "hi", true);
let (x, y, z) = tup;
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```rust
fn divide(a: f64, b: f64) -> Result<f64, String> {
    if b == 0.0 {
        Err("–î–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å".to_string())
    } else {
        Ok(a / b)
    }
}

let result = divide(4.0, 2.0);
match result {
    Ok(val) => println!("–†–µ–∑—É–ª—å—Ç–∞—Ç: {}", val),
    Err(e) => println!("–û—à–∏–±–∫–∞: {}", e),
}
```

## Ownership, Borrowing, Lifetimes

```rust
fn print_length(s: &String) {
    println!("{}", s.len());
}

let s = String::from("hello");
print_length(&s);  // –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–µ (borrow)
```

## –¢–µ—Å—Ç—ã

```rust
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_add() {
        assert_eq!(add(2, 3), 5);
    }
}
```

## Traits (–ß–µ—Ä—Ç—ã)

Traits ‚Äî —ç—Ç–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –≤ —Å—Ç–∏–ª–µ Rust.

```rust
trait Greet {
    fn greet(&self) -> String;
}

struct Person {
    name: String,
}

impl Greet for Person {
    fn greet(&self) -> String {
        format!("–ü—Ä–∏–≤–µ—Ç, {}!", self.name)
    }
}
```

## Modules –∏ use

–ú–æ–¥—É–ª–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –∫–æ–¥ –ø–æ —Ñ–∞–π–ª–∞–º –∏ –ø–∞–ø–∫–∞–º.

```rust
// src/main.rs
mod utils;

fn main() {
    utils::hello();
}

// src/utils.rs
pub fn hello() {
    println!("–ü—Ä–∏–≤–µ—Ç –∏–∑ –º–æ–¥—É–ª—è!");
}
```

- `mod` ‚Äî –æ–±—ä—è–≤–ª—è–µ—Ç –º–æ–¥—É–ª—å
- `pub` ‚Äî –¥–µ–ª–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é/—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–æ—Å—Ç—É–ø–Ω–æ–π —Å–Ω–∞—Ä—É–∂–∏
- `use` ‚Äî –∏–º–ø–æ—Ä—Ç:

```rust
use crate::utils::hello;
```

## Async / Await (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å)

```rust
use tokio::time::{sleep, Duration};

#[tokio::main]
async fn main() {
    say_hello().await;
}

async fn say_hello() {
    sleep(Duration::from_secs(1)).await;
    println!("–ü—Ä–∏–≤–µ—Ç, async!");
}
```

–î–ª—è async-–∫–æ–¥–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è tokio –∏–ª–∏ async-std

–í Cargo.toml:

```toml
[dependencies]
tokio = { version = "1", features = ["full"] }
```

# –ò—Ç–µ—Ä–∞—Ç–æ—Ä—ã

```rust
let numbers = vec![1, 2, 3, 4, 5];
let doubled: Vec<i32> = numbers.iter().map(|x| x * 2).collect();
```

## –ú–µ—Ç–æ–¥—ã –∏—Ç–µ—Ä–∞—Ç–æ—Ä–æ–≤
###  `.next()`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –∏–ª–∏ None, –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å

### `.collect()`

–ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∏—Ç–µ—Ä–∞—Ç–æ—Ä –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é (Vec, HashMap, –∏ —Ç.–¥.)

### `.map()`

–ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç

```rust
let doubled: Vec<i32> = vec![1, 2, 3].iter().map(|x| x * 2).collect();
```

### `.filter()`

–ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã, –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—â–∏–µ —É—Å–ª–æ–≤–∏–µ

```rust
let even: Vec<i32> = vec![1,2,3,4].into_iter().filter(|x| x % 2 == 0).collect();
```

### `.enumerate()`

–û–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã –≤ (index, item)

```rust
for (i, val) in vec.iter().enumerate() {
    println!("{}: {}", i, val);
}
```

### `.fold()`

–°–≤–æ–¥–∏—Ç —ç–ª–µ–º–µ–Ω—Ç—ã –∫ –æ–¥–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é

```rust
let sum = vec![1,2,3].iter().fold(0, |acc, x| acc + x);
```

### `.find()`

–ù–∞—Ö–æ–¥–∏—Ç –ø–µ—Ä–≤—ã–π –ø–æ–¥—Ö–æ–¥—è—â–∏–π —ç–ª–µ–º–µ–Ω—Ç

```rust
let found = vec![1, 2, 3].iter().find(|&&x| x > 1); // Some(&2)
```

### `.all(), .any()`

–ü—Ä–æ–≤–µ—Ä—è—é—Ç –≤—Å–µ/—Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç

```rust
vec![1,2,3].iter().all(|x| *x > 0); // true
vec![1,2,3].iter().any(|x| *x == 2); // true
```

### `.take(n)`

–ë–µ—Ä—ë—Ç –ø–µ—Ä–≤—ã–µ `n` —ç–ª–µ–º–µ–Ω—Ç–æ–≤

```rust
let first_two: Vec<_> = vec![1,2,3].into_iter().take(2).collect();
```

### `.skip(n)`

–ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –ø–µ—Ä–≤—ã–µ `n` —ç–ª–µ–º–µ–Ω—Ç–æ–≤

```rust
let rest: Vec<_> = vec![1,2,3].into_iter().skip(1).collect(); // [2, 3]
```

### `.zip(other)`

–û–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–≤–∞ –∏—Ç–µ—Ä–∞—Ç–æ—Ä–∞

```rust
let a = [1, 2, 3];
let b = ["a", "b", "c"];
let zipped: Vec<_> = a.iter().zip(b.iter()).collect();
```

### `.chain(other)`

–°–æ–µ–¥–∏–Ω—è–µ—Ç –¥–≤–∞ –∏—Ç–µ—Ä–∞—Ç–æ—Ä–∞

```rust
let joined: Vec<_> = [1,2].iter().chain([3,4].iter()).collect();
```


### `.flatten()`

¬´–†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç¬ª –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∏—Ç–µ—Ä–∞—Ç–æ—Ä—ã

```rust
let nested = vec![vec![1,2], vec![3,4]];
let flat: Vec<_> = nested.into_iter().flatten().collect(); // [1,2,3,4]
```

### `.flat_map()`

–ö–∞–∫ `map` + `flatten`

```rust
let nums = vec![1, 2];
let result: Vec<_> = nums.into_iter().flat_map(|x| vec![x, x * 10]).collect(); // [1,10,2,20]
```

# Option –∏ Result

## Option<T>

```rust
let maybe_number: Option<i32> = Some(10);

match maybe_number {
    Some(n) => println!("–ß–∏—Å–ª–æ: {}", n),
    None => println!("–ù–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è"),
}
```

## Result<T, E>

```rust
fn safe_div(a: i32, b: i32) -> Result<i32, &'static str> {
    if b == 0 {
        Err("–ù–µ–ª—å–∑—è –¥–µ–ª–∏—Ç—å –Ω–∞ –Ω–æ–ª—å")
    } else {
        Ok(a / b)
    }
}
```

# Pattern Matching

```rust
let (x, y) = (10, 20);

match (x, y) {
    (0, _) => println!("x == 0"),
    (_, 0) => println!("y == 0"),
    _ => println!("–û–±–∞ –Ω–µ –Ω—É–ª–∏"),
}
```

# Smart Pointers (Box, Rc, RefCell)

| –£–∫–∞–∑–∞—Ç–µ–ª—å              | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                | –ò–∑–º–µ–Ω—è–µ–º–æ—Å—Ç—å  | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ—Ç–æ–∫–æ–≤  | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å                         | –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏            |
| ---------------------- | ----------------------------------------- | ------------- | ------------------ | ------------------------------------------ | --------------------------- |
| `Box<T>`               | –í—ã–¥–µ–ª–µ–Ω–∏–µ –≤ –∫—É—á–µ                          | ‚ùå (–±–µ–∑ `mut`) | ‚úÖ (–µ—Å–ª–∏ `T: Send`) | –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–µ —Ç–∏–ø—ã, –ø–µ—Ä–µ–Ω–æ—Å —Ç—è–∂—ë–ª—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä | –ö–æ–º–ø–∏–ª—è—Ü–∏—è                  |
| `Rc<T>`                | –ü–æ–¥—Å—á—ë—Ç —Å—Å—ã–ª–æ–∫ (–æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω—ã–π)             | ‚ùå             | üö´                 | –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è           | –ö–æ–º–ø–∏–ª—è—Ü–∏—è                  |
| `RefCell<T>`           | –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∏–∑–º–µ–Ω—è–µ–º–æ—Å—Ç—å                   | ‚úÖ             | üö´                 | –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ `&self` –≤ –æ–¥–Ω–æ–º –ø–æ—Ç–æ–∫–µ    | **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ**              |
| `Rc<RefCell<T>>`       | –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ + –∏–∑–º–µ–Ω—è–µ–º–æ—Å—Ç—å (–æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω—ã–π)  | ‚úÖ             | üö´                 | –û–±—â–∏–π –¥–æ—Å—Ç—É–ø —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∏–∑–º–µ–Ω–µ–Ω–∏—è      | –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ                  |
| `Arc<T>`               | –ü–æ–¥—Å—á—ë—Ç —Å—Å—ã–ª–æ–∫ (–º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã–π)            | ‚ùå             | ‚úÖ                  | –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏                  | –ö–æ–º–ø–∏–ª—è—Ü–∏—è                  |
| `Arc<Mutex<T>>`        | –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ + –∏–∑–º–µ–Ω—è–µ–º–æ—Å—Ç—å (–º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã–π) | ‚úÖ             | ‚úÖ                  | –û–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ —Å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º       | **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ + –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** |
| `Cell<T>`              | –ö–æ–ø–∏—Ä—É–µ–º—ã–µ —Ç–∏–ø—ã —Å –∏–∑–º–µ–Ω—è–µ–º–æ—Å—Ç—å—é           | ‚úÖ (`Copy`)    | üö´                 | –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤ –≤ `&self`             | –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ                  |
| `Mutex<T>`             | –ó–∞—â–∏—Ç–∞ –æ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞          | ‚úÖ             | ‚úÖ                  | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏        | –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ                  |
| `Ref<T>` / `RefMut<T>` | –í–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∏–∑ `RefCell<T>`              | ‚úÖ / ‚úÖ         | üö´                 | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏ —Å—Å—ã–ª–æ–∫           | –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ                  |
| `Weak<T>`              | –°–ª–∞–±–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ `Rc`/`Arc`               | ‚ùå             | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–±—ë—Ä—Ç–∫–∏ | –ò–∑–±–µ–≥–∞—Ç—å —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö —Å—Å—ã–ª–æ–∫                | –ö–æ–º–ø–∏–ª—è—Ü–∏—è                  |

## `Box<T>`

```rust
let b = Box::new(5); // –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ 5 –≤ –∫—É—á—É (heap)
println!("b = {}", b); // –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑—ã–º–µ–Ω–æ–≤—ã–≤–∞–µ—Ç—Å—è ‚Äî –ø–µ—á–∞—Ç–∞–µ—Ç 5

```
üìå –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

- `Box::new(5)` —Å–æ–∑–¥–∞—ë—Ç —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ 5 –≤ –∫—É—á–µ
- `b` –≤–ª–∞–¥–µ–µ—Ç —ç—Ç–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
- `Box` –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–∞–º—è—Ç—å –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏

–ü–æ–ª–µ–∑–Ω–æ –≤ —Ä–µ–∫—É—Ä—Å–∏—è—Ö:
```rust
enum List {
    Cons(i32, Box<List>),
    Nil,
}
```

## `Rc<T>` (Reference Counter)

Reference Counter (Ref Count) ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ –æ–¥–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –≤ –ø–∞–º—è—Ç–∏. –ö–∞–∫ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω—è—è —Å—Å—ã–ª–∫–∞ —É–¥–∞–ª—è–µ—Ç—Å—è ‚Äî –æ–±—ä–µ–∫—Ç –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `Rc` –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–∞—è:
```rust
struct RcBox<T> {
    strong: Cell<usize>, // —Å—á—ë—Ç—á–∏–∫ "—Å–∏–ª—å–Ω—ã—Ö" —Å—Å—ã–ª–æ–∫
    value: T,            // –∑–Ω–∞—á–µ–Ω–∏–µ
}
```
–ü—Ä–∏–º–µ—Ä:
```rust
let a = Rc::new(String::from("hello"));  // –°–æ–∑–¥–∞—ë—Ç—Å—è `RcBox { strong: 1, value: "hello" }`
let b = Rc::clone(&a);  // `clone()` —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç `strong` –¥–æ `2`
```

üì¶ –ü–æ–¥ –∫–∞–ø–æ—Ç–æ–º:
- –°–æ–∑–¥–∞—ë—Ç—Å—è `RcBox { strong: 1, value: "hello" }`
- `clone()` —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç `strong` –¥–æ `2`
- –ü—Ä–∏ `drop(b)` ‚Üí `strong -= 1`
- –ö–æ–≥–¥–∞ `strong == 0`, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `drop(value)` –∏ –ø–∞–º—è—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è

> –°—Å—ã–ª–∫–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è "—Å–∏–ª—å–Ω–æ–π" –ø–æ—Ç–æ–º—É, —á—Ç–æ —Å–∏–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Å–ª–∞–±–æ–π - —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á—ë—Ç—á–∏–∫.


```rust
use std::rc::Rc;

let a = Rc::new(String::from("hello")); // —Å–æ–∑–¥–∞—ë–º —Å—Ç—Ä–æ–∫—É –≤ –∫—É—á–µ —Å –ø–æ–¥—Å—á—ë—Ç–æ–º —Å—Å—ã–ª–æ–∫
let b = Rc::clone(&a); // —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫ —Å—Å—ã–ª–æ–∫ (–æ–±–∞ a –∏ b –≤–ª–∞–¥–µ—é—Ç —Å—Ç—Ä–æ–∫–æ–π)

println!("a = {}, b = {}", a, b);
println!("Rc count = {}", Rc::strong_count(&a)); // 2

```

üìå –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

- `a` —Å–æ–∑–¥–∞—ë—Ç –æ–±—ä–µ–∫—Ç —Å 1 –≤–ª–∞–¥–µ–ª—å—Ü–µ–º
- `Rc::clone` –¥–µ–ª–∞–µ—Ç –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —Å—á—ë—Ç—á–∏–∫ = 2
- –°—Ç—Ä–æ–∫–∞ —É–¥–∞–ª–∏—Ç—Å—è, –∫–æ–≥–¥–∞ –≤—Å–µ –≤–ª–∞–¥–µ–ª—å—Ü—ã –≤—ã–π–¥—É—Ç –∏–∑ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏

> –ü–æ–ª–µ–∑–Ω–æ –ø—Ä–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –≥—Ä–∞—Ñ–æ–≤ –∏–ª–∏ –¥–µ—Ä–µ–≤—å–µ–≤ —Å —Ä–∞–∑–¥–µ–ª—è–µ–º—ã–º–∏ —É–∑–ª–∞–º–∏.

## `RefCell<T>` ‚Äî –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∏–∑–º–µ–Ω—è–µ–º–æ—Å—Ç—å

```rust
use std::cell::RefCell;

let x = RefCell::new(5);        // —Å–æ–∑–¥–∞—ë–º –æ–±—ë—Ä—Ç–∫—É —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∏–∑–º–µ–Ω—è—Ç—å
*x.borrow_mut() += 1;           // –ø–æ–ª—É—á–∞–µ–º –º—É—Ç–∞–±–µ–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –∏ –∏–∑–º–µ–Ω—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ

println!("x = {}", x.borrow()); // borrow() –¥–∞—ë—Ç –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—É—é —Å—Å—ã–ª–∫—É: 6
```

üìå –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
- `borrow_mut()` –¥–∞—ë—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
- –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ `borrow()` –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö `borrow_mut()`
- –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç **–≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**, –Ω–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

## `Rc<RefCell<T>>` ‚Äî —Å–æ–≤–º–µ—Å—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø —Å –∏–∑–º–µ–Ω—è–µ–º–æ—Å—Ç—å—é

````rust
use std::rc::Rc;
use std::cell::RefCell;

let data = Rc::new(RefCell::new(42));     // –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ RefCell –≤–Ω—É—Ç—Ä–∏ Rc
let a = Rc::clone(&data);                 // —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫ Rc
*a.borrow_mut() += 1;                     // –∏–∑–º–µ–Ω—è–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

println!("data = {}", data.borrow());     // 43
````

üìå –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
- `Rc` —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤–ª–∞–¥–µ–Ω–∏–µ–º, `RefCell` –¥–∞—ë—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∏–∑–º–µ–Ω—è–µ–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ `Rc::clone`, –Ω–æ –¥–∞–Ω–Ω—ã–µ –≤–Ω—É—Ç—Ä–∏ ‚Äî —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `borrow()` / `borrow_mut()`
- –ü–æ–ª–µ–∑–Ω–æ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ **—Ö–æ—Ç—è—Ç –º–µ–Ω—è—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ** (–æ—á–µ–Ω—å –ø–æ–ø—É–ª—è—Ä–µ–Ω –≤ tree/graph —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö)


## `Arc<T>` ‚Äî –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ

```rust
use std::sync::Arc;

let shared = Arc::new(5);        // —Å–æ–∑–¥–∞—ë—Ç –æ–±—ä–µ–∫—Ç –≤ –∫—É—á–µ —Å –∞—Ç–æ–º–∞—Ä–Ω—ã–º —Å—á—ë—Ç—á–∏–∫–æ–º —Å—Å—ã–ª–æ–∫
let t1 = Arc::clone(&shared);    // –∫–ª–æ–Ω–∏—Ä—É–µ–º –≤–ª–∞–¥–µ–Ω–∏–µ –¥–ª—è –¥—Ä—É–≥–æ–≥–æ –ø–æ—Ç–æ–∫–∞

println!("t1 = {}, shared = {}", t1, shared); // –æ–±–∞ –≤–∏–¥—è—Ç –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ
```

üìå –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

- `Arc` (atomic Rc) –±–µ–∑–æ–ø–∞—Å–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω—ã–º –∏–ª–∏ –∑–∞—â–∏—â–µ–Ω–æ (`Mutex`), –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å

## Mutex<T> + Arc<T> ‚Äî –∏–∑–º–µ–Ω—è–µ–º–æ—Å—Ç—å –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–º –∫–æ–¥–µ

```rust
use std::sync::{Arc, Mutex};
use std::thread;

let counter = Arc::new(Mutex::new(0));      // –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ Mutex –∏ Arc
let c = Arc::clone(&counter);               // –∫–ª–æ–Ω–∏—Ä—É–µ–º –≤–ª–∞–¥–µ–Ω–∏–µ

let handle = thread::spawn(move || {
    let mut num = c.lock().unwrap();        // –ø–æ–ª—É—á–∞–µ–º —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –¥–æ—Å—Ç—É–ø
    *num += 1;                              // –∏–∑–º–µ–Ω—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ (0 ‚Üí 1)
});

handle.join().unwrap();
println!("counter = {:?}", counter.lock().unwrap()); // 1
```

üìå –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

- `Mutex::new(0)` —Å–æ–∑–¥–∞—ë—Ç –∑–Ω–∞—á–µ–Ω–∏–µ, –∑–∞—â–∏—â—ë–Ω–Ω–æ–µ –æ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- `.lock()` –¥–∞—ë—Ç –¥–æ—Å—Ç—É–ø –∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥—Ä—É–≥–∏–µ –ø–æ—Ç–æ–∫–∏
- `Arc` –¥–µ–ª–∏—Ç –≤–ª–∞–¥–µ–Ω–∏–µ –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏
- –ü–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –ø–æ—Ç–æ–∫–∞ –∏–∑ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏, `Mutex` —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è

## Cell<T> ‚Äî Copy-—Ç–∏–ø—ã —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –∏–∑–º–µ–Ω—è–µ–º–æ—Å—Ç—å—é

```rust
use std::cell::Cell;

let c = Cell::new(10); // –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Cell —Å Copy-—Ç–∏–ø–æ–º
c.set(20);             // –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å –∑–Ω–∞—á–µ–Ω–∏—è
let x = c.get();       // –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è (20)

println!("x = {}", x);
```
üìå –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
- –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å —Ç–∏–ø–∞–º–∏, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–º–∏ `Copy`
- –ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –¥–∞–∂–µ –≤–Ω—É—Ç—Ä–∏ `&self` (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ `impl`)

## –ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å –Ω—É–∂–Ω—ã–π Smart Pointer?

| –¢—Ä–µ–±—É–µ—Ç—Å—è                   | –ò—Å–ø–æ–ª—å–∑—É–π                   |
| --------------------------- | --------------------------- |
| –•—Ä–∞–Ω–∏—Ç—å –≤ –∫—É—á–µ              | `Box<T>`                    |
| –†–∞–∑–¥–µ–ª–∏—Ç—å –º–µ–∂–¥—É –≤–ª–∞–¥–µ–ª—å—Ü–∞–º–∏ | `Rc<T>` –∏–ª–∏ `Arc<T>`        |
| –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ –∏–∑–º–µ–Ω—è—Ç—å          | `RefCell<T>` –∏–ª–∏ `Mutex<T>` |
| –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å          | `Arc<T>` + `Mutex<T>`       |




# Macros

```rust
macro_rules! say_hello {
    () => {
        println!("–ü—Ä–∏–≤–µ—Ç –∏–∑ –º–∞–∫—Ä–æ—Å–∞!");
    };
}

fn main() {
    say_hello!();
}
```

# –õ–∞–π—Ñ—Ç–∞–π–º—ã (Lifetimes)

```rust
fn longest<'a>(a: &'a str, b: &'a str) -> &'a str {
    if a.len() > b.len() { a } else { b }
}
```

- `'a` ‚Äî **–ø–∞—Ä–∞–º–µ—Ç—Ä –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏**
- `&'a str` ‚Äî —Å—Ç—Ä–æ–∫–æ–≤–∞—è —Å—Å—ã–ª–∫–∞, –∂–∏–≤—É—â–∞—è –Ω–µ –º–µ–Ω—å—à–µ `'a`
- –í–æ–∑–≤—Ä–∞—â–∞–µ–º–∞—è —Å—Å—ã–ª–∫–∞ —Ç–∞–∫–∂–µ –¥–æ–ª–∂–Ω–∞ –∂–∏—Ç—å —Ö–æ—Ç—è –±—ã `'a`

üß† –≠—Ç–æ –∑–Ω–∞—á–∏—Ç: —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∂–∏–≤—ë—Ç —Å—Ç–æ–ª—å–∫–æ –∂–µ, —Å–∫–æ–ª—å–∫–æ —Å–∞–º—ã–π –∫–æ—Ä–æ—Ç–∫–∏–π –∏–∑ –≤—Ö–æ–¥–æ–≤.

## `'static` –ª–∞–π—Ñ—Ç–∞–π–º

```rust
static NAME: &str = "Rustacean"; // –∂–∏–≤—ë—Ç –≤—Å—é –ø—Ä–æ–≥—Ä–∞–º–º—É

fn get_name() -> &'static str {
    "Forever" // —Å—Ç—Ä–æ–∫–æ–≤—ã–π –ª–∏—Ç–µ—Ä–∞–ª –∂–∏–≤—ë—Ç –≤ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–∞–º—è—Ç–∏
}
```

## –ö–æ–≥–¥–∞ –ª–∞–π—Ñ—Ç–∞–π–º—ã –Ω—É–∂–Ω—ã?

### –§—É–Ω–∫—Ü–∏–∏ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å—Å—ã–ª–∫–∞–º–∏

```rust
fn combine<'a>(a: &'a str, b: &'a str) -> String {
    format!("{}{}", a, b)
}
```

### –°—Ç—Ä—É–∫—Ç—É—Ä—ã —Å –ø–æ–ª—è–º–∏-—Å—Å—ã–ª–∫–∞–º–∏

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–µ –º–æ–∂–µ—Ç –∂–∏—Ç—å –¥–æ–ª—å—à–µ, —á–µ–º –µ—ë —Å—Å—ã–ª–∫–∏.

```rust
struct Book<'a> {
    title: &'a str,
    author: &'a str,
}
```

–û—Å–Ω–æ–≤–Ω—ã–µ Smart Pointer‚Äô—ã –≤ Rust
–£–∫–∞–∑–∞—Ç–µ–ª—å	–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ	–°–º–µ–Ω–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞	–ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å
Box<T>	–ö—É—á–∞. –•—Ä–∞–Ω–∏—Ç –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç	‚úÖ move	üö´
Rc<T>	–ü–æ–¥—Å—á—ë—Ç —Å—Å—ã–ª–æ–∫ (–æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω—ã–π)	‚úÖ clone()	üö´
Arc<T>	–ü–æ–¥—Å—á—ë—Ç —Å—Å—ã–ª–æ–∫ (–º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã–π)	‚úÖ clone()	‚úÖ
RefCell<T>	–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∏–∑–º–µ–Ω—è–µ–º–æ—Å—Ç—å (–æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω–∞—è)	‚úÖ —á–µ—Ä–µ–∑ borrow()	üö´
Mutex<T>	–ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∏–∑–º–µ–Ω—è–µ–º–æ—Å—Ç—å	‚úÖ —á–µ—Ä–µ–∑ lock()	‚úÖ

