# `Box<T>`

`Box<T>` ‚Äî —ç—Ç–æ —É–º–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–¥–µ–ª—è–µ—Ç –ø–∞–º—è—Ç—å –≤ –∫—É—á–µ (`heap`) 
–∏ –≤–ª–∞–¥–µ–µ—Ç —ç—Ç–æ–π –ø–∞–º—è—Ç—å—é. –ö–æ–≥–¥–∞ `Box<T>` –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏, 
–æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —ç—Ç—É –ø–∞–º—è—Ç—å.

## üìå –û—Å–Ω–æ–≤–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ Box<T>:

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞                 | –ó–Ω–∞—á–µ–Ω–∏–µ                  |
| ------------------------------ | ------------------------- |
| –í—ã–¥–µ–ª—è–µ—Ç –ø–∞–º—è—Ç—å –≤ –∫—É—á–µ         | ‚úÖ                         |
| –í–ª–∞–¥–µ–µ—Ç –æ–±—ä–µ–∫—Ç–æ–º               | ‚úÖ (–µ–¥–∏–Ω–æ–ª–∏—á–Ω–æ–µ –≤–ª–∞–¥–µ–Ω–∏–µ)  |
| –ë–µ–∑–æ–ø–∞—Å–µ–Ω –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤          | ‚úÖ (–µ—Å–ª–∏ `T: Send + Sync`) |
| –†–∞–∑–º–µ—Ä –∏–∑–≤–µ—Å—Ç–µ–Ω –≤ compile-time | ‚úÖ                         |
| –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π `Drop`          | ‚úÖ (–æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–∞–º—è—Ç—å)    |


## üîç –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Box<T> –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º?
–í–Ω—É—Ç—Ä–∏, Box<T> ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ T, –∫–æ—Ç–æ—Ä—ã–π:
- –≤—ã–¥–µ–ª—è–µ—Ç—Å—è –≤ –∫—É—á–µ (heap)
- –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è –ø—Ä–∏ drop()
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–ª–ª–æ–∫–∞—Ç–æ—Ä (–æ–±—ã—á–Ω–æ malloc / free –∏–ª–∏ —á–µ—Ä–µ–∑ std::alloc)

> Rust –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ Box<T> –≤—Å–µ–≥–¥–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω –≤–ª–∞–¥–µ–ª–µ—Ü.


## üìú –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```rust
let b = Box::new(10);
println!("b = {}", b); // —Ä–∞–∑—ã–º–µ–Ω–æ–≤—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

### üì¶ –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

#### Box::new(10): 

- –≤—ã–∑—ã–≤–∞–µ—Ç `alloc` –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è `i32` –≤ –∫—É—á–µ
- –∫–æ–ø–∏—Ä—É–µ—Ç `10` —Ç—É–¥–∞
- –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Box<T>`, –∫–æ—Ç–æ—Ä—ã–π —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —ç—Ç–æ—Ç —É—á–∞—Å—Ç–æ–∫ –ø–∞–º—è—Ç–∏

#### –ü—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –æ–±–ª–∞—Å—Ç–∏:
- –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `Drop` –¥–ª—è `Box<T>`
- –ø–∞–º—è—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `dealloc`

## üìê –ó–∞—á–µ–º –Ω—É–∂–µ–Ω Box<T>

### –î–ª—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã—Ö —Ç–∏–ø–æ–≤:
```rust
enum List {
    Cons(i32, Box<List>),
    Nil,
}
```

## üß± Box<dyn Trait> ‚Äî –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –¥–∏—Å–ø–µ—Ç—á–∏—Ä–æ–≤–∞–Ω–∏–µ

```rust
trait Animal {
    fn speak(&self);
}

struct Dog;
impl Animal for Dog {
    fn speak(&self) { println!("Woof!"); }
}

let a: Box<dyn Animal> = Box::new(Dog);
a.speak(); // Woof!
```

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `Box<dyn Trait>` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–ø–∞
- –†–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É (`vtable`) + —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –¥–∞–Ω–Ω—ã–µ