## üü¢ –ß—Ç–æ —Ç–∞–∫–æ–µ RefCell<T>

`RefCell<T>` ‚Äî —ç—Ç–æ —É–º–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–π (borrowing) 
–≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (runtime), –∞ –Ω–µ –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏, –∫–∞–∫ –æ–±—ã—á–Ω–æ –¥–µ–ª–∞–µ—Ç Rust.

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –æ–±—ã—á–Ω—ã—Ö —Å—Å—ã–ª–æ–∫, –≥–¥–µ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞, 
`RefCell` –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–º–µ—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω—ã–µ (`&T`) –∏–ª–∏ –æ–¥–∏–Ω –º—É—Ç–∞–±–µ–ª—å–Ω—ã–π (`&mut T`) –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º, 
–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—è —ç—Ç–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏.

## üß© –ó–∞—á–µ–º –Ω—É–∂–µ–Ω RefCell<T>

- Rust –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–º–µ—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏ –∏–∑–º–µ–Ω—è–µ–º—ã–µ, –∏ –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã–µ —Å—Å—ã–ª–∫–∏ –∏–∑-–∑–∞ –ø—Ä–∞–≤–∏–ª –≤–ª–∞–¥–µ–Ω–∏—è.
- –ù–æ –∏–Ω–æ–≥–¥–∞ —Ö–æ—á–µ—Ç—Å—è –∏–∑–º–µ–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ ¬´–≤–Ω–µ—à–Ω–µ¬ª –¥–æ—Å—Ç—É–ø–Ω—ã –∫–∞–∫ –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö —Å `Rc<T>`).
- RefCell —Ä–µ—à–∞–µ—Ç —ç—Ç—É –∑–∞–¥–∞—á—É, –¥–∞–≤–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–µ–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –≤–Ω—É—Ç—Ä–∏, –¥–∞–∂–µ –µ—Å–ª–∏ —É –≤–∞—Å —Ç–æ–ª—å–∫–æ –Ω–µ–∏–∑–º–µ–Ω—è–µ–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ `RefCell`.
- –ü—Ä–∏ —ç—Ç–æ–º –ø—Ä–∞–≤–∏–ª–∞ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –∏ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –≤—ã–∑–æ–≤–µ—Ç panic!

## üîß –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
````rust
use std::cell::RefCell;

fn main() {
    let data = RefCell::new(5);

    {
        let r1 = data.borrow(); // –ø–µ—Ä–≤—ã–π –Ω–µ–∏–∑–º–µ–Ω—è–µ–º–æ–µ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–µ
        let r2 = data.borrow(); // –µ—â—ë –æ–¥–∏–Ω –Ω–µ–∏–∑–º–µ–Ω—è–µ–º–æ–µ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–µ
        println!("r1 = {}, r2 = {}", *r1, *r2);  // r1 = 5, r2 = 5
    } // r1 –∏ r2 –≤—ã—Ö–æ–¥—è—Ç –∏–∑ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏, –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è

    {
        let mut w = data.borrow_mut(); // –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∏–∑–º–µ–Ω—è–µ–º—É—é —Å—Å—ã–ª–∫—É
        *w += 10;
        println!("w = {}", *w);  // w = 15
    }

    println!("data = {}", data.borrow());  // data = 15
}
````
> –ï—Å–ª–∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –≤—ã–∑–≤–∞—Ç—å `borrow_mut()` –ø–æ–∫–∞ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π `borrow()`, –ø—Ä–æ–≥—Ä–∞–º–º–∞ —É–ø–∞–¥—ë—Ç —Å panic.

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º (—É–ø—Ä–æ—â—ë–Ω–Ω–æ)

````rust
struct RefCell<T> {
    value: T,
    borrow_flag: Cell<BorrowFlag>,
}

enum BorrowFlag {
    Unused,       // –Ω–µ—Ç –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–π
    Reading(usize),// —Å–∫–æ–ª—å–∫–æ –µ—Å—Ç—å –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã—Ö borrows
    Writing,      // –µ—Å—Ç—å –∏–∑–º–µ–Ω—è–µ–º–æ–µ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–µ
}
````

- –ü—Ä–∏ –≤—ã–∑–æ–≤–µ `borrow()`: –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–µ—Ç –∏–∑–º–µ–Ω—è–µ–º–æ–≥–æ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏—è, —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫ —á—Ç–µ–Ω–∏—è.
- –ü—Ä–∏ –≤—ã–∑–æ–≤–µ `borrow_mut()`: –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–π, —Å—Ç–∞–≤–∏–º —Ñ–ª–∞–≥ `Writing`.
- –ü—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –æ–±–ª–∞—Å—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è `Ref<T>` –∏–ª–∏ `RefMut<T>` —É–º–µ–Ω—å—à–∞–µ–º —Å—á—ë—Ç—á–∏–∫–∏.


## üîÑ –°–≤—è–∑–∫–∞ —Å Rc

````rust
use std::rc::Rc;
use std::cell::RefCell;

fn main() {
    let shared = Rc::new(RefCell::new(10));

    {
        let mut val = shared.borrow_mut();
        *val += 5;
    }

    println!("{}", shared.borrow());  // 15
}
````

